package admin

import (
	"fmt"
	"github.com/labstack/echo/v4"
	"github.com/loganlanou/logans3d-v4/storage/db"
	"github.com/loganlanou/logans3d-v4/views/layout"
)

templ BoxForm(c echo.Context, box *db.BoxCatalog) {
	@layout.AdminBase(c, "Box Form") {
		<div class="min-h-screen bg-background dark:bg-gradient-to-br dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
			<!-- Header -->
			<div class="bg-card/50 backdrop-blur-sm border-b border-border sticky top-0 z-50">
				<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
					<div class="flex justify-between items-center py-4">
						<h1 class="text-2xl font-bold text-foreground">
							if box != nil {
								Edit Box
							} else {
								Add New Box
							}
						</h1>
						<a href="/admin/shipping" class="text-muted-foreground hover:text-foreground transition-colors duration-200">
							← Back to Box Catalog
						</a>
					</div>
				</div>
			</div>
			<!-- Form -->
			<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
				<div class="bg-card/50 backdrop-blur-sm rounded-xl border border-border p-6">
					<form
						if box != nil {
							method="POST"
							action={ templ.SafeURL(fmt.Sprintf("/admin/shipping/boxes/%s", box.Sku)) }
						} else {
							method="POST"
							action="/admin/shipping/boxes"
						}
						class="space-y-6"
					>
						<!-- Basic Information -->
						<div class="space-y-4">
							<h3 class="text-lg font-semibold text-foreground mb-4">Box Information</h3>
							<!-- SKU -->
							<div>
								<label for="sku" class="block text-sm font-medium text-muted-foreground mb-1">
									SKU <span class="text-red-600 dark:text-red-400">*</span>
								</label>
								<input
									type="text"
									id="sku"
									name="sku"
									required
									if box != nil {
										value={ box.Sku }
										readonly
									}
									class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
									placeholder="e.g., CXBSS21"
								/>
								if box != nil {
									<p class="mt-1 text-xs text-muted-foreground">SKU cannot be changed after creation</p>
								}
							</div>
							<!-- Name -->
							<div>
								<label for="name" class="block text-sm font-medium text-muted-foreground mb-1">
									Name <span class="text-red-600 dark:text-red-400">*</span>
								</label>
								<input
									type="text"
									id="name"
									name="name"
									required
									if box != nil {
										value={ box.Name }
									}
									class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
									placeholder="e.g., 9x7x5"
								/>
							</div>
						</div>
						<!-- Dimensions -->
						<div class="space-y-4">
							<h3 class="text-lg font-semibold text-foreground mb-4">Dimensions</h3>
							<div class="grid grid-cols-3 gap-4">
								<!-- Length -->
								<div>
									<label for="length_inches" class="block text-sm font-medium text-muted-foreground mb-1">
										Length (in) <span class="text-red-600 dark:text-red-400">*</span>
									</label>
									<input
										type="number"
										step="0.1"
										id="length_inches"
										name="length_inches"
										required
										if box != nil {
											value={ fmt.Sprintf("%.1f", box.LengthInches) }
										}
										class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
										placeholder="9.0"
									/>
								</div>
								<!-- Width -->
								<div>
									<label for="width_inches" class="block text-sm font-medium text-muted-foreground mb-1">
										Width (in) <span class="text-red-600 dark:text-red-400">*</span>
									</label>
									<input
										type="number"
										step="0.1"
										id="width_inches"
										name="width_inches"
										required
										if box != nil {
											value={ fmt.Sprintf("%.1f", box.WidthInches) }
										}
										class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
										placeholder="7.0"
									/>
								</div>
								<!-- Height -->
								<div>
									<label for="height_inches" class="block text-sm font-medium text-muted-foreground mb-1">
										Height (in) <span class="text-red-600 dark:text-red-400">*</span>
									</label>
									<input
										type="number"
										step="0.1"
										id="height_inches"
										name="height_inches"
										required
										if box != nil {
											value={ fmt.Sprintf("%.1f", box.HeightInches) }
										}
										class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
										placeholder="5.0"
									/>
								</div>
							</div>
							if box != nil {
								<div class="bg-background/30 border border-border rounded-lg p-3">
									<p class="text-sm text-muted-foreground">
										Volume: <span class="font-mono text-emerald-400">{ fmt.Sprintf("%.0f in³", box.LengthInches * box.WidthInches * box.HeightInches) }</span>
									</p>
								</div>
							}
						</div>
						<!-- Weight and Cost -->
						<div class="space-y-4">
							<h3 class="text-lg font-semibold text-foreground mb-4">Weight & Cost</h3>
							<div class="grid grid-cols-2 gap-4">
								<!-- Weight -->
								<div>
									<label for="box_weight_oz" class="block text-sm font-medium text-muted-foreground mb-1">
										Box Weight (oz) <span class="text-red-600 dark:text-red-400">*</span>
									</label>
									<input
										type="number"
										step="0.1"
										id="box_weight_oz"
										name="box_weight_oz"
										required
										if box != nil {
											value={ fmt.Sprintf("%.1f", box.BoxWeightOz) }
										}
										class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
										placeholder="4.0"
									/>
									<p class="mt-1 text-xs text-muted-foreground">Empty box weight</p>
								</div>
								<!-- Cost -->
								<div>
									<label for="unit_cost_usd" class="block text-sm font-medium text-muted-foreground mb-1">
										Unit Cost (USD) <span class="text-red-600 dark:text-red-400">*</span>
									</label>
									<input
										type="number"
										step="0.01"
										id="unit_cost_usd"
										name="unit_cost_usd"
										required
										if box != nil {
											value={ fmt.Sprintf("%.2f", box.UnitCostUsd) }
										}
										class="w-full px-3 py-2 bg-background/50 border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
										placeholder="0.51"
									/>
									<p class="mt-1 text-xs text-muted-foreground">Cost per box</p>
								</div>
							</div>
						</div>
						<!-- Status -->
						<div class="space-y-4">
							<h3 class="text-lg font-semibold text-foreground mb-4">Status</h3>
							<div class="flex items-center">
								<input
									type="checkbox"
									id="is_active"
									name="is_active"
									if box == nil || (box.IsActive.Valid && box.IsActive.Bool) {
										checked
									}
									class="w-4 h-4 text-emerald-600 bg-background/50 border-border rounded focus:ring-emerald-500 focus:ring-2"
								/>
								<label for="is_active" class="ml-2 text-sm font-medium text-foreground">
									Active (available for use)
								</label>
							</div>
						</div>
						<!-- Form Actions -->
						<div class="flex justify-end space-x-4 pt-6 border-t border-border">
							<a
								href="/admin/shipping"
								class="px-6 py-2 bg-muted hover:bg-muted/80 text-foreground font-semibold rounded-lg transition-colors duration-200"
							>
								Cancel
							</a>
							<button
								type="submit"
								class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors duration-200"
							>
								if box != nil {
									Update Box
								} else {
									Create Box
								}
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	}
}
