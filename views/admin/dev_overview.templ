package admin

import (
	"fmt"
	"github.com/labstack/echo/v4"
	"github.com/loganlanou/logans3d-v4/internal/types"
	"github.com/loganlanou/logans3d-v4/views/layout"
)

templ DevOverview(c echo.Context, sysInfo types.SystemInfo, dbStats types.DatabaseStats, memStats types.MemoryStats) {
	@layout.AdminBase(c, "Developer Overview") {
		@layout.AdminContainer() {
			<!-- Header -->
			<div class="flex justify-between items-center mb-8">
				<h1 class="admin-text-primary admin-text-2xl admin-font-bold">System Overview</h1>
				<div class="flex space-x-3">
					<button onclick="window.location.reload()" class="admin-btn admin-btn-secondary">
						<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
						</svg>
						Refresh
					</button>
					<button onclick="triggerGC()" class="admin-btn admin-btn-primary">
						<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
						</svg>
						Force GC
					</button>
				</div>
			</div>

			<!-- Application Status Banner -->
			<div class="admin-card mb-6">
				<div class="flex items-center justify-between p-6">
					<div class="flex items-center space-x-4">
						<img src="/public/images/favicon.png" alt="Logan's 3D" class="w-12 h-12 rounded-lg"/>
						<div>
							<h2 class="admin-text-primary text-xl font-semibold">Logan's 3D v4</h2>
							<p class="admin-text-muted text-sm">Process ID: { fmt.Sprintf("%d", sysInfo.PID) }</p>
						</div>
					</div>
					<div class="flex items-center space-x-6">
						<div class="text-right">
							<p class="admin-text-muted text-sm">Uptime</p>
							<p class="admin-text-primary text-lg font-semibold">{ sysInfo.Uptime }</p>
						</div>
						<div class="inline-flex items-center px-4 py-2 rounded-full bg-green-900/30 border border-green-500/30">
							<span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
							<span class="text-green-400 text-sm font-medium">Running</span>
						</div>
					</div>
				</div>
			</div>

			<!-- Metrics Grid -->
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
				<!-- Go Version -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Go Version</h3>
						<p class="text-3xl font-bold admin-text-primary mb-1">{ sysInfo.GoVersion }</p>
						<p class="text-xs admin-text-muted">{ sysInfo.Architecture }</p>
					</div>
				</div>

				<!-- Operating System -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Operating System</h3>
						<p class="text-3xl font-bold admin-text-primary mb-1">{ sysInfo.OS }</p>
						<p class="text-xs admin-text-muted">{ sysInfo.Architecture } architecture</p>
					</div>
				</div>

				<!-- Memory Allocated -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Memory Allocated</h3>
						<p class="text-3xl font-bold text-blue-400 mb-1">{ fmt.Sprintf("%.1f", memStats.AllocMB) } MB</p>
						<p class="text-xs admin-text-muted">{ fmt.Sprintf("%.1f MB system", memStats.SysMB) }</p>
					</div>
				</div>

				<!-- Goroutines -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Active Goroutines</h3>
						<p class="text-3xl font-bold text-purple-400 mb-1">{ fmt.Sprintf("%d", memStats.Goroutines) }</p>
						<p class="text-xs admin-text-muted">{ fmt.Sprintf("%d GC cycles", memStats.NumGC) }</p>
					</div>
				</div>
			</div>

			<!-- Database Stats -->
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
				<!-- Products -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Products</h3>
						<p class="text-3xl font-bold text-green-400 mb-1">{ fmt.Sprintf("%d", dbStats.ProductCount) }</p>
						<p class="text-xs admin-text-muted">Total products in catalog</p>
					</div>
				</div>

				<!-- Categories -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Categories</h3>
						<p class="text-3xl font-bold text-orange-400 mb-1">{ fmt.Sprintf("%d", dbStats.CategoryCount) }</p>
						<p class="text-xs admin-text-muted">Active categories</p>
					</div>
				</div>

				<!-- Database Size -->
				<div class="admin-card hover:shadow-lg transition-shadow duration-300">
					<div class="p-6">
						<h3 class="text-sm font-medium admin-text-muted mb-2">Database Size</h3>
						<p class="text-3xl font-bold text-cyan-400 mb-1">{ dbStats.DatabaseSize }</p>
						<p class="text-xs admin-text-muted">SQLite database</p>
					</div>
				</div>
			</div>
		}

		<!-- JavaScript for Developer Overview -->
		<script>
			async function triggerGC() {
				try {
					const response = await fetch('/dev/gc', { method: 'POST' });
					const result = await response.json();
					alert('Garbage collection completed. Memory stats will update shortly.');
					setTimeout(() => window.location.reload(), 500);
				} catch (error) {
					console.error('Error triggering GC:', error);
					alert('Error triggering garbage collection');
				}
			}
		</script>
	}
}
