package admin

import (
	"fmt"
	"github.com/labstack/echo/v4"
	"github.com/loganlanou/logans3d-v4/internal/types"
	"github.com/loganlanou/logans3d-v4/views/layout"
)

templ DevOverview(c echo.Context, sysInfo types.SystemInfo, dbStats types.DatabaseStats, memStats types.MemoryStats) {
	@layout.AdminBase(c, "Developer Overview") {
		@layout.AdminContainer() {
			<!-- Header -->
			<div class="flex justify-between items-center mb-8">
				<h1 class="admin-text-primary admin-text-2xl admin-font-bold">System Overview</h1>
				<div class="flex space-x-3">
					<button onclick="window.location.reload()" class="admin-btn admin-btn-secondary">
						<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
						</svg>
						Refresh
					</button>
					<button onclick="triggerGC()" class="admin-btn admin-btn-primary">
						<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
						</svg>
						Force GC
					</button>
				</div>
			</div>

			<!-- Status Cards -->
			<div class="admin-stats-grid mb-8">
				<!-- Application Status -->
				<div class="admin-stat-card">
					<div class="mb-4">
						<div class="flex items-center justify-center mb-2">
							<img src="/public/images/favicon.png" alt="Logan's 3D" class="w-12 h-12 rounded-lg"/>
						</div>
						<h3 class="admin-text-primary admin-font-semibold text-center mb-2">Logan's 3D v4</h3>
						<div class="flex items-center justify-center">
							<div class="inline-flex items-center px-3 py-1 rounded-full bg-green-900/30 border border-green-500/30">
								<span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
								<span class="text-green-400 text-sm font-medium">Running</span>
							</div>
						</div>
					</div>
					<div class="grid grid-cols-2 gap-4 pt-4 border-t border-slate-700">
						<div class="text-center">
							<div class="admin-stat-number text-xl">{ sysInfo.Uptime }</div>
							<div class="admin-stat-label">Uptime</div>
						</div>
						<div class="text-center">
							<div class="admin-stat-number text-xl">{ fmt.Sprintf("%d", sysInfo.PID) }</div>
							<div class="admin-stat-label">Process ID</div>
						</div>
					</div>
				</div>

				<!-- System Information -->
				<div class="admin-stat-card">
					<div class="mb-4 text-center">
						<div class="text-4xl mb-2">üíª</div>
						<h3 class="admin-text-primary admin-font-semibold">System Info</h3>
					</div>
					<div class="space-y-3">
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ sysInfo.GoVersion }</div>
							<div class="admin-text-muted text-xs">Go Version</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ sysInfo.OS }</div>
							<div class="admin-text-muted text-xs">Operating System</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ sysInfo.Architecture }</div>
							<div class="admin-text-muted text-xs">Architecture</div>
						</div>
					</div>
				</div>

				<!-- Memory Usage -->
				<div class="admin-stat-card">
					<div class="mb-4 text-center">
						<div class="text-4xl mb-2">üß†</div>
						<h3 class="admin-text-primary admin-font-semibold">Memory Usage</h3>
					</div>
					<div class="grid grid-cols-2 gap-3">
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%.1f", memStats.AllocMB) }</div>
							<div class="admin-text-muted text-xs">Alloc (MB)</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%.1f", memStats.SysMB) }</div>
							<div class="admin-text-muted text-xs">System (MB)</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%d", memStats.Goroutines) }</div>
							<div class="admin-text-muted text-xs">Goroutines</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%d", memStats.NumGC) }</div>
							<div class="admin-text-muted text-xs">GC Cycles</div>
						</div>
					</div>
				</div>

				<!-- Database Stats -->
				<div class="admin-stat-card">
					<div class="mb-4 text-center">
						<div class="text-4xl mb-2">üóÑÔ∏è</div>
						<h3 class="admin-text-primary admin-font-semibold">Database</h3>
					</div>
					<div class="grid grid-cols-3 gap-3">
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%d", dbStats.ProductCount) }</div>
							<div class="admin-text-muted text-xs">Products</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ fmt.Sprintf("%d", dbStats.CategoryCount) }</div>
							<div class="admin-text-muted text-xs">Categories</div>
						</div>
						<div class="text-center">
							<div class="admin-text-primary admin-font-medium">{ dbStats.DatabaseSize }</div>
							<div class="admin-text-muted text-xs">DB Size</div>
						</div>
					</div>
				</div>
			</div>
		}

		<!-- JavaScript for Developer Overview -->
		<script>
			async function triggerGC() {
				try {
					const response = await fetch('/dev/gc', { method: 'POST' });
					const result = await response.json();
					alert('Garbage collection completed. Memory stats will update shortly.');
					setTimeout(() => window.location.reload(), 500);
				} catch (error) {
					console.error('Error triggering GC:', error);
					alert('Error triggering garbage collection');
				}
			}
		</script>
	}
}
